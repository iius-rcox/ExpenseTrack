apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-keyvault-secrets
  namespace: expenseflow-staging
  labels:
    app: expenseflow-api
    environment: staging
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: "b7275093-e2c3-4ff5-92fa-4af1530c0e21"
    keyvaultName: "iius-akv"
    tenantId: "953922e6-5370-4a01-a3d5-773a30df726b"
    objects: |
      array:
        - |
          objectName: expenseflow-staging-postgresql
          objectType: secret
          objectAlias: postgresql-connection-string
        - |
          objectName: expenseflow-openai-endpoint
          objectType: secret
          objectAlias: openai-endpoint
        - |
          objectName: expenseflow-openai-apikey
          objectType: secret
          objectAlias: openai-apikey
        - |
          objectName: document-intelligence-endpoint
          objectType: secret
          objectAlias: document-intelligence-endpoint
        - |
          objectName: document-intelligence-apikey
          objectType: secret
          objectAlias: document-intelligence-apikey
  # Sync as Kubernetes Secret for env var usage
  secretObjects:
    - secretName: expenseflow-secrets
      type: Opaque
      data:
        - objectName: postgresql-connection-string
          key: postgresql-connection-string
        - objectName: openai-endpoint
          key: openai-endpoint
        - objectName: openai-apikey
          key: openai-apikey
        - objectName: document-intelligence-endpoint
          key: document-intelligence-endpoint
        - objectName: document-intelligence-apikey
          key: document-intelligence-apikey
